{% extends "base.html" %}
{% block content %}
<h1>Create Scenario</h1>
<form method="POST" class="scenario-form" id="scenario-form">
  {{ form.hidden_tag() }}

  <div class="form-group">
    <label>Mode</label>
    {{ form.mode() }}
  </div>

  <div class="form-group">
    {{ form.difficulty.label }}
    {{ form.difficulty() }}
  </div>

  <div class="form-group" id="preset-row">
    {{ form.preset_id.label }}
    {{ form.preset_id() }}
  </div>

  <div id="custom-fields">
    <div class="form-group">
      {{ form.category.label }}
      {{ form.category(id='category-input', size=60, placeholder='e.g., professor rounding to 90, client escalation, salary negotiation') }}
      <div class="chips">
        <button type="button" class="chip" data-val="professor rounding to 90">Professor rounding to 90</button>
        <button type="button" class="chip" data-val="grade appeal regrade Q3">Grade appeal</button>
        <button type="button" class="chip" data-val="client delay negotiation 5%">Client delay</button>
        <button type="button" class="chip" data-val="salary negotiation new offer">Salary negotiation</button>
        <button type="button" class="chip" data-val="deadline extension research travel">Deadline extension</button>
      </div>
    </div>

    <div class="form-group">
      {{ form.focus.label }}
      {{ form.focus(size=40, placeholder='e.g., clarity, tone, conciseness') }}
    </div>
  </div>

  <div class="actions">{{ form.submit(class_="btn primary") }}</div>
</form>

<script>
  function updateMode() {
    const mode = document.querySelector('input[name="mode"]:checked').value;
    const custom = document.getElementById('custom-fields');
    const preset = document.getElementById('preset-row');
    if (mode === 'preset') {
      custom.style.display = 'none';
      preset.style.display = '';
    } else {
      custom.style.display = '';
      preset.style.display = '';
    }
  }
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('input[name="mode"]').forEach(i => i.addEventListener('change', updateMode));
    updateMode();
    const input = document.getElementById('category-input');
    document.querySelectorAll('.chip').forEach(ch => ch.addEventListener('click', () => input.value = ch.dataset.val));
  });
</script>
{% endblock %}
